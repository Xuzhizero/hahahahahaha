---
title: 代码在单独执行节点输入时无报错，但在完整流程试运行时会报错——故障排查
slug: xy6eh06zuqi77ltx
url: https://www.yuque.com/caogongzi/pu6995/xy6eh06zuqi77ltx
---

直接将代码执行节点的输入放入，没有报错，但是试运行，走一个完整的流程，就会报错。为什么？

# 实验1
通过试运行，代码执行模块的输入为：

<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);">{ "input": "{\"query\": {\"content\": \"\\u4eba\\u4e8b USV\"}, \"records\": [{\"segment\": {\"id\": \"9e13d9b3-01a7-45dd-bf85-6fa9c598a9de\", \"position\": 1, \"document_id\": \"3138a36e-eb0a-4280-984c-9c027465d0bd\", \"content\": \"\\u4eba\\u4e8b\\u5bf9USV\", \"sign_content\": \"\\u4eba\\u4e8b\\u5bf9USV\", \"answer\": null, \"word_count\": 6, \"tokens\": 5, \"keywords\": [\"text\"], \"index_node_id\": \"4eb86ad3-e6ce-4458-9c54-7616af047e9a\", \"index_node_hash\": \"17b50884348de1a3671e0c891bd9ec95cf02825aebeb0987f62737f47991d446\", \"hit_count\": 0, \"enabled\": true, \"disabled_at\": null, \"disabled_by\": null, \"status\": \"completed\", \"created_by\": \"710d8049-714f-4813-9a59-554c72795471\", \"created_at\": 1744971410, \"indexing_at\": 1745215845, \"completed_at\": 1745215845, \"error\": null, \"stopped_at\": null, \"document\": {\"id\": \"3138a36e-eb0a-4280-984c-9c027465d0bd\", \"data_source_type\": \"upload_file\", \"name\": \"text\", \"doc_type\": null, \"doc_metadata\": null}}, \"child_chunks\": null, \"score\": null, \"tsne_position\": null}, {\"segment\": {\"id\": \"9e13d9b3-01a7-45dd-bf85-6fa9c598a9de\", \"position\": 1, \"document_id\": \"3138a36e-eb0a-4280-984c-9c027465d0bd\", \"content\": \"\\u4eba\\u4e8b\\u5bf9USV\", \"sign_content\": \"\\u4eba\\u4e8b\\u5bf9USV\", \"answer\": null, \"word_count\": 6, \"tokens\": 5, \"keywords\": [\"text\"], \"index_node_id\": \"4eb86ad3-e6ce-4458-9c54-7616af047e9a\", \"index_node_hash\": \"17b50884348de1a3671e0c891bd9ec95cf02825aebeb0987f62737f47991d446\", \"hit_count\": 0, \"enabled\": true, \"disabled_at\": null, \"disabled_by\": null, \"status\": \"completed\", \"created_by\": \"710d8049-714f-4813-9a59-554c72795471\", \"created_at\": 1744971410, \"indexing_at\": 1745215845, \"completed_at\": 1745215845, \"error\": null, \"stopped_at\": null, \"document\": {\"id\": \"3138a36e-eb0a-4280-984c-9c027465d0bd\", \"data_source_type\": \"upload_file\", \"name\": \"text\", \"doc_type\": null, \"doc_metadata\": null}}, \"child_chunks\": null, \"score\": 0.8666905, \"tsne_position\": null}]}\n" }</font>

<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);"></font>

<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);">报错码：</font>

<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);">{ "$error": "Function execution failed, please check the code of the function. Detail: Exception: ('Error in main: ', \"'input'\")\n" }</font>

<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);"></font>

<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);">直接将上面文本输入，正常运行</font>



# 实验2
<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);">如果先对http请求的输出经过文本处理，然后再让代码执行模块接收来自文本处理的输入，情况与上面一致</font>

<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);"></font>

# <font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);">实验3</font>
在代码中添加“data_ori = params['input'].replace('\\\\', '\\')”，以为是转义的问题：



```plain
async def main(args: Args) -> Output:
    import json
    params = args.params
    data_ori = params['input'].replace('\\\\', '\\')
    data = json.loads(data_ori)
    
    # # 提取 body 字段并再次解析
    # body_data = json.loads(data["body"])

    # 提取 records 字段并再次解析
    input_data = json.loads(data["input"])
    records_list = input_data["records"] 


    

    content_list = []
    content = ""
    # 遍历 records 并提取每个 segment 的 content
    for record in records_list:
        if record["score"] is None: #刷掉那些分数为空的内容
            continue
        segment = record["segment"]
        content = segment["content"]
        print("Segment Content:")
        print(content)
        print("-" * 50)
        content_list.append(content)

    
    # 构建输出对象
    ret: Output = {
        "content": content, # 最后一个content内容
        "content_list": content_list, #content的收纳数组
    }
    return ret
```

结果也是一样



# 实验4
对一部分代码进行注释：

```plain
async def main(args: Args) -> Output:
    import json
    params = args.params
    data_ori = params['input'].replace('\\\\', '\\')
    data = json.loads(data_ori)
    
    # # 提取 body 字段并再次解析
    # body_data = json.loads(data["body"])

    # 提取 records 字段并再次解析
    # input_data = json.loads(data["input"])
    # records_list = input_data["records"] 


    

    content_list = []
    content = ""
    # 遍历 records 并提取每个 segment 的 content
    # for record in records_list:
    #     if record["score"] is None: #刷掉那些分数为空的内容
    #         continue
    #     segment = record["segment"]
    #     content = segment["content"]
    #     print("Segment Content:")
    #     print(content)
    #     print("-" * 50)
    #     content_list.append(content)

    
    # 构建输出对象
    ret: Output = {
        "content": content, # 最后一个content内容
        "content_list": content_list, #content的收纳数组
    }
    return ret
```

运行成功！



# 实验5
增加一行代码取消注释，结果报错

```python
async def main(args: Args) -> Output:
    import json
    params = args.params
    data_ori = params['input'].replace('\\\\', '\\')
    data = json.loads(data_ori)
    
    # # 提取 body 字段并再次解析
    # body_data = json.loads(data["body"])

    # 提取 records 字段并再次解析
    input_data = json.loads(data["input"])
    # records_list = input_data["records"] 


    

    content_list = []
    content = ""
    # 遍历 records 并提取每个 segment 的 content
    # for record in records_list:
    #     if record["score"] is None: #刷掉那些分数为空的内容
    #         continue
    #     segment = record["segment"]
    #     content = segment["content"]
    #     print("Segment Content:")
    #     print(content)
    #     print("-" * 50)
    #     content_list.append(content)

    
    # 构建输出对象
    ret: Output = {
        "content": content, # 最后一个content内容
        "content_list": content_list, #content的收纳数组
    }
    return ret
```



结论：问题可能出在“input_data = json.loads(data["input"])” 这里。



# 实验6
怀疑是压根没有input这个键。所以在输出时调用`list(data.keys())`，发现确实没有input。

```python
async def main(args: Args) -> Output:
    import json
    params = args.params
    data_ori = params['input'].replace('\\\\', '\\')
    data = json.loads(data_ori)
    
    # # 提取 body 字段并再次解析
    # body_data = json.loads(data["body"])

    # 提取 records 字段并再次解析
    # input_data = json.loads(data["input"])
    # records_list = input_data["records"] 


    

    content_list = []
    content = ""
    # 遍历 records 并提取每个 segment 的 content
    # for record in records_list:
    #     if record["score"] is None: #刷掉那些分数为空的内容
    #         continue
    #     segment = record["segment"]
    #     content = segment["content"]
    #     print("Segment Content:")
    #     print(content)
    #     print("-" * 50)
    #     content_list.append(content)

    
    # 构建输出对象
    ret: Output = {
        "content": content, # 最后一个content内容
        "content_list": content_list, #content的收纳数组
        "keys": list(data.keys())
    }
    return ret
```

![](https://cdn.nlark.com/yuque/0/2025/png/2408029/1745314856421-880b19cd-28f8-4588-bf72-22340a26aa2e.png)

结论：在输入时，input会被省去，直接输入的是input的值。







<font style="color:rgb(0, 0, 0);background-color:rgb(247, 247, 252);"></font>





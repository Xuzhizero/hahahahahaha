---
title: 虚实融合仿真测试设施设计
slug: vuo3o70oti8k10y9
url: https://www.yuque.com/caogongzi/pu6995/vuo3o70oti8k10y9
---

# 概述
## 立项背景
受舟山市政府委托，研究院承担“智能网联无人艇海上测试场建设方案论证”工作，由于**虚拟测试是可重复、可穷举和多批次的测试，具有低成本和高效率的优点**，因此测试场需要配置虚实融合的船舶仿真测试系统。由此，研究院需要开展虚实融合的船舶仿真测试系统研发，除满足自用外，还可推广到无人船海上测试场及其他相关单位。

## ![智能网联无人艇海上测试体系架构图](https://cdn.nlark.com/yuque/0/2025/png/2408029/1756104702541-c937b181-35c7-4e96-830e-4520cc5ac761.png)
上图是智能网联无人艇海上测试场的体系架构图。<font style="color:rgb(0,0,0);">参考广东省地方标准《无人水面艇和智能船舶海上测试管理规范》，第5章“测试大纲”第1节表格1，以及考虑未来无人艇的长远应用需求，自主航行的任务可以被大致划分为四大类型：远程操控、自主循迹、自主避障、集群协同。</font>岸端模型和测试场（其中包含船端模型）通过彼此信息交互，共同支撑自主航行的四大任务。

## 仿真功能需求汇总
<font style="color:rgb(0,0,0);">根据中国海事局《自主航行试验技术与检验暂行规则》，船舶开展自主航行、远程控制航行试验前，试验责任单位应开展风险评估，向船舶检验机构申请航行试验检验，申请航行试验检验需要提交自主航行、远程控制功能的仿真试验结果，自主航行、远程控制功能的仿真试验和系泊功能试验结果得到批准是开展试验的必要条件之一。</font>

<font style="color:rgb(0,0,0);"></font>

<font style="color:rgb(0,0,0);">参考广东省地方标准《无人水面艇和智能船舶海上测试管理规范》，第5章“测试大纲”第1节表格1，</font>仿真测试设施的功能需求现列表如下——



| 方面 | 验证算法 | 仿真功能需求 |
| --- | --- | --- |
| 基本需求 |  | 1. 仿真中的物体尺度、空间尺度与实际一致   2. 支持直接导入实船 CAD 图并据此直接得到关键模型参数   3. 能在仿真中添加标识：期望点、期望路径、实际路径   4. 导入真实海洋场景（如舟山海域） |
| 规划与控制 | 循迹算法 | 模拟不同等级、方向的风浪扰动 |
| 规划与控制 | 极端工况下运动控制算法 | 1. 满舵后反向满舵测试（紧急避碰、恶劣海况）   2. 不同风浪等级与方向下船体六自由度抖动/摆动模拟 |
| 规划与控制 | 避碰算法 | 1. 添加随机或预定路径移动的障碍船只/跟踪目标   2. 添加海面与海底障碍（浮筒、岛礁、灯塔），电子围栏具备海底坡度 |
| 规划与控制 | 自主靠泊算法 | 1. 支持多种地形环境：港口、狭窄水域等   2. 不同等级、方向风浪条件下靠泊动作 |
| 感知定位 | 图像视觉增强算法 | 1. 不同光照条件下视觉效果   2. 不同天气条件下视觉效果 |
| 感知定位 | 雷达–视觉融合算法 | 雷达回波仿真及接收    |




表格解释：

+ **“方面”列**：用于对仿真需求进行分类，涵盖了基本平台搭建、规划与控制以及感知定位三大类模块。
+ **“验证算法”列**：标明在该“方面”下所要验证或应用的核心算法类型，比如循迹算法、避碰算法、自主靠泊算法等。
+ **“仿真功能需求”列**：罗列了为了验证某种算法，在仿真环境中必须具备的具体功能，以保证各小组能够针对不同算法或场景进行全面的测试与评估。

## 


# 系统指标
## 定性系统指标
考虑到系统指标定量的困难，目前系统指标暂未定量，但是从定性上说，仿真系统应该要具备：

1. 全面性。动力学仿真模型框架要在搭建伊始就具备涵盖几乎所有海况的理论技术条件
2. 仿真数据易得。仿真模型中的数据方便获得，方便二次处理，方便可视化
3. 传感器高精度。模型中需要加入物理特性高保真的传感器
4. 易扩展。如果未来有新的传感器添加需求，或者有新的动力学模型改进需求（例如将舵-桨驱动方式改成直翼舵桨驱动方式，单个直翼舵桨驱动改成多个直翼舵桨驱动），在模型的更改上需要足够方便
5. 模型递推快速性。由于未来需要纳入多种复杂的海况，因此模型的复杂度在未来一定会很高，因此模型递推的解算速度需要足够快
6. 高保真可视化。为了给感知算法提供高保真的感知背景，环境可视化需要具有较高的保真度
7. 实时性。搭建在不同主机之间的数据沟通需要确保低时延，例如搭载有算法的主机和专门的仿真机之间的数据互通
8. 迭代快速。整个项目工程在缺少人力的前提下，需要能够快速迭代。这一点可以依靠成熟的开源代码、成熟的社区生态等因素支撑
9. 易协同。算法测试人员如果需要仿真，可以方便进行协同仿真，他们为了仿真而额外学习的与仿真部分的内容需要足够少，协同仿真尽可能方便
10. 低成本。采用的方案对经费的开销需要足够小





# 仿真系统总体介绍
## 系统基本组成
整个系统分为三个分系统：智能航行算法分系统上跑制导、导航、控制、感知定位算法，模拟仿真分系统负责动力学与运动学推演，以及实现可视化与传感器仿真，智能机舱分系统上负责接入底层发动机控制器等机电设备，实现硬件在环。



## 仿真流程


仿真流程图如下图所示：

![硬件在环仿真流程图](https://cdn.nlark.com/yuque/0/2025/png/2408029/1756102823605-4edc0207-4246-4127-a1ab-dd4fed824deb.png)

具体解释如下：

在同一个WIFI子网下，规划控制模块发出档位信息给智能机舱分系统，经过机桨匹配下发合适的期望转速，然后再经过发动机控制单元输出对应的控制指令，到模拟仿真分系统种的模型递推模块，模型递推模块通过递推得到速度和位姿后再发回到规划控制模块（作为决策、规划和控制算法的输入数据），并发给可视化模块进行更新可视化。



在 Simulink 中，每个仿真步首先读取来自 ROS 的控制命令，然后将推进力、环境干扰（包括 UE5 返回的粒子采样风速／波速信息）一并带入六自由度动力学模型，求解线速度和角速度并积分得到位姿。Simulink 以高频率跑通这套动力学＋运动学，通过ROS Topic把最新姿态推送给上层算法，也推给 UE5 用于渲染同步。



可视化模块方面接收到位姿和预先设定的风速、显著波高、波谱类型、地形高度图等宏观参数后，会实时把船体放到三维地形上，利用海面流体材质和粒子特效做到从大尺度波浪到船体周边溅水的高保真渲染，并采集船体周边的局部风浪信息（可能区别于总体的风浪布局）；内置的传感器插件（激光雷达、摄像头、IMU 等）则在场景里读取几何、光照、天气、动态目标等信息，生成点云、图像、惯性测量等原始数据，再返回给模型递推模块或者是智能航行算法分系统中的感知定位模块，为感知与定位算法提供闭环验证。



这样一来，算法在智能航行分系统上决策，模型递推分系统负责做高频物理推演，可视化分系统在同一台机器上做高保真渲染与传感器仿真，并通过粒子采样将局部环境细节回馈给动力学模块。宏观参数驱动大尺度海况，粒子群采样补足微观波浪，最终在多频率、多主机、多模型之间形成一个动态一致、可视可测的自主航行仿真闭环。







##  数据流接口汇总
| 流程环节 | 分系统 | 职责描述 | 数据流入 | 流入来源分系统 | 数据流出 | 流出分系统 |
| --- | --- | --- | --- | --- | --- | --- |
| **环境渲染可视化** | 可视化分系统<br/> | 渲染仿真场景（船体，海面、障碍物、天气） | 船体状态（位置/姿态） | 模型递推分系统 | 场景渲染、视觉传感器视图、环境扰动参数（如波高、风向） | 投屏分系统 |
| **感知元素输入** | | 模拟雷达、AIS电子图传感器，用于障碍信息提取 | 无 | 无 | 点云、图像、惯性测量等原始数据 | 模型递推分系统 |
| **通航情况模拟** | | 渲染并驱动其他水面交通目标（来船）的运动轨迹 | 无 | 无 | 无 | 无 |
| **动力学建模与受力解算** | 模型递推分系统 | 计算船体运动状态，解算流体力与姿态变化，保持时间主控 | 1. 外部扰动力（波浪、风）<br/>2. 推进/舵控制指令 | 1. 可视化分系统<br/>2. 智能航行算法分系统 | 船体状态（位置、速度、姿态） | 可视化分系统 |
| **设置参数输出** | | 设置地形数据，设置宏观风浪参数 | 无 | 无 | 地形数据，风浪宏观参数，如风速风向、潮流流速流向、显著波高等 | 可视化分系统 |
| **控制与规划算法实现** | 智能航行算法分系统 | 执行避障、路径规划、运动控制算法 | 船体运动状态、气象、地形数据 | 模型递推分系统 | 控制指令（推进器/舵角） | 模型递推分系统 |
| **感知定位算法实现** | | 执行图像增强，目标识别，多源传感器数据融合等算法 | 传感器信息（图像，激光雷达点云等） | 模型递推分系统 | 感知信息（如障碍物信息，来船目标信息等） | 智能航行算法分系统 |
| **投屏** | 投屏分系统 | 投屏到大屏幕 | 可视化渲染结果画面 | 可视化分系统 | 无 | 无 |


特别说明：

+ 所有模块均以 Simulink 为**时间主控中心**，通过发布 `/clock` 保持 ROS 2 同步；
+ 控制器、感知与路径算法全部由 ROS 2 实现，以便直接迁移至实船系统；
+ Simulink 通过官方工具箱作为 **桥梁平台**：既负责仿真，也负责转发数据。

## 




# 分系统设计
系统总体可分为智能航行算法分系统，模型递推分系统和可视化分系统，其中智能航行算法分系统的陈述暂略。

## 模型递推分系统
### 与总体的接口
| 流程环节 | 平台/模块 | 职责描述 | 流入数据 | 流入来源分系统/模块 | 流出数据 | 输出分系统/模块 |
| --- | --- | --- | --- | --- | --- | --- |
| 控制指令接收 | 执行机构模型 | 接收 ROS 系统下发的推进器指令，转换为推进力和扭矩 | 螺旋桨转速、矢量推进器方向等控制指令 | ROS系统 | 推进力和力矩 | 船体模型 |
| 地形设置参数输出 | 地形信息设置模块 | 为UE5设置真实地形数据 | 无 | 无 | 地形数据 | UE5 |
| 风、浪宏观参数设置 | 风浪参数设置模块 | 为UE5设置风浪宏观参数  | 无 | 无 | 风浪宏观参数，如风速风向、潮流流速流向、显著波高等 | UE5 |
| 环境干扰计算 | 环境干扰模型 + 解算器 | 根据船体局部采样粒子处的风浪信息计算水动力干扰力和力矩 | UE5 返回的局部环境采样信息 | UE5 | 环境干扰力 & 力矩 | 船体模型 |
| 船体动力学仿真 | 船体模型 + 运动学模型 | 将推进力、干扰力与船体动力学模型耦合，计算六自由度速度并积分得到位姿 | 推进力 & 力矩;   环境干扰力;    | 环境干扰模型、执行机构模型 | 位姿信息  | UE5 |
| 传感器数据采集 | 各类传感器模型 | 收集来自UE5的激光雷达、摄像头、IMU 等多种传感器输出，并将得到的传感器数据发送给 ROS 系统，用于导航、定位和感知算法测试 | 传感器数据 | UE5 | 传感器数据 | ROS系统 |
| 船体真实状态汇总和反馈 | Simulink | 船体真实状态反馈给 ROS，作为智能航行算法的输入 | 船体、环境状态数据 | Simulink、UE5 | 船体、环境状态数据<br/>---------<br/>视场、分辨率、采样频率、噪声模型参数 | ROS系统<br/>--------------<br/>UE5各类传感器 |




### **功能描述**
基于MATLAB&Simulink的 模型分析系统是整个仿真平台的“推递仿真”核心，承担以下主要功能：

1. **推进力和力矩计算**  
在“执行机构模型”中接收来自 ROS 的推进指令（如螺旋桨转速、矢量推进器方向），并转化为对应的推进力和力矩，为动力学计算提供输入。
2. **环境干扰计算**  
通过“环境干扰模型”结合“解算器”，使用风、波宏观参数（及可选的 UE5 局部采样信息）精确地计算附加在船体上的水动力干扰力矩，涵盖波浪冲击、洋流作用等多种海况效应。
3. **船体动力学仿真**  
在“船体模型”中建立六自由度动力学方程，耦合推进与干扰力后求解线速度和角速度，并在“运动学模型”中将速度积分得到实时位姿，完整再现船体在复杂海况下的运动行为。
4. **状态输出**  
将最新的位姿信息实时发送给 UE5，取得高保真的可视化效果；同时将船体真实状态反馈给 ROS，用于算法性能评估和闭环验证。
5. **传感器虚拟化**  
借助“各类传感器模型”，生成仿真激光雷达点云、摄像头图像、IMU 数据等多源传感器输出，为感知与融合算法提供真实感知输入。
6. **统一仿真步长**  
通过锁定仿真步长，保证与 ROS 算法模块和 UE5 可视化模块之间高一致性的数据流通。





## 可视化分系统
### 与总体的接口
| 流程环节 | 平台/模块 | 职责描述 | 数据流入 | 流入来源分系统/模块 | 数据流出 | 输出分系统/模块 |
| --- | --- | --- | --- | --- | --- | --- |
| **位姿同步** | 被控船体 | 接收模型分系统动力学/运动学计算的六自由度位姿，更新船体 对象的位置与朝向 | 船体位姿信息  | 模型分系统 | 无 | 无 |
| **地形渲染** | 三维地形 | 加载并渲染由 Simulink 输出的地形数据 | 地形设置参数 | 模型分系统 | 地形信息 | UE5各类传感器模块 |
| **大尺度海况生成** | 风浪流环境 | 根据宏观环境参数生成海面波浪动态材质与流场模拟 | 风速、风向、显著波高、峰值周期、波谱类型、洋流速度等宏观参数 | 模型分系统 | 风浪信息 | UE5各类传感器模块 |
| **局部风浪信息获取** | 环绕船体粒子群 | 在船体表面及周边布置采样质点，获取采样质点处的具体风浪信息 | 采样质点处的具体风浪信息 | UE5被控船体 | 船体采样点位置；来自“风浪流环境”的波高/波速信息   | Simulink解算器 |
| **场景光照渲染** | 光照／天气系统 | 按照在UE5中设置的光照参数（太阳高度、方位、强度）、天气类型（晴、阴、雨、雾）调整全局光照与气氛效果 | 无 | 无 | 光照、天气信息 | UE5各类传感器模块 |
| **通航情况模拟** | 来船模拟 | 渲染并驱动其他水面交通目标（来船）的运动轨迹，为传感器生成动态物体 | 无 | 无 | 来船信息（如距离、方位、图像等） | UE5各类传感器模块 |
| **传感器仿真** | 各类传感器插件 | 基于完整场景（地形、船体、波浪、来船、光照）生成激光雷达、相机、IMU 等传感器，可以用于采集UE5中渲染场景的信息 | 位姿信息；场景几何与材质；光照／天气状态 | 地形信息<br/>风浪信息<br/>光照、天气信息<br/>来船信息 | 传感器数据 (点云、图像序列、IMU 原始测量等) | Simulink各类传感器模块 |


### 功能描述
基于UE5的可视化分系统是整个仿真平台的“感知与展示”核心，它不仅为物理仿真提供高保真的渲染环境，更承担了关键的传感器仿真职责。具体来说，主要承担以下功能：

1. **场景构建与更新**
    - **地形渲染**：读取 Simulink 提供的地形设置数据（如高度图和网格参数），动态加载与更新海岸线、海床等三维地形。
    - **大尺度海况**：结合风速、显著波高等宏观参数，使用流场模拟插件渲染真实感极强的海面波浪。
    - **局部特效**：在船体周围自动布置采样点，获取船体局部位置的具体海况信息。
2. **动态对象同步**
    - **船体同步**：持续接收主仿真模块的六自由度位姿指令，实时更新船体的位置和姿态，确保物理运动与可视渲染严格一致。
    - **交通目标**：按脚本或算法输入驱动“来船”模型的运动，为协同测试或碰撞场景提供动态干扰。
3. **气氛与光照**
    - 依据光照高度、太阳方位、云量及天气类型（雨、雾等），自动调节全局光照、阴影、天空盒和环境雾效，为图像感知算法提供真实感强的视觉条件。
4. **传感器级仿真**
    - 集成多种传感器插件（激光雷达、立体／鱼眼相机、红外相机、IMU），在完整渲染场景中进行采样，实时生成点云、图像帧和惯性测量数据。
    - 获取来自Simulink定义的各类传感器参数（视场、分辨率、采样频率、噪声模型）



# 虚实融合的数字孪生系统介绍
仿真系统除了用于实船调试之前的基础测试平台以外，还是一个极好的基于深度学习的各类算法的训练载体。通过将岸端的仿真系统和船端系统进行实时数据交互和任务协同，可以实现虚实融合，从而极大提升船端模型的智能化程度。





![岸端和船端数字孪生逻辑框图](https://cdn.nlark.com/yuque/0/2025/png/2408029/1756102593713-8bb0ac06-0297-4a18-92b3-74f434adde81.png)

上图是“岸端—船端”协同的数字孪生训练与部署框架。右侧粉色区域是岸端模型：包含数据库、仿真环境与算力中心（内部运行神经网络等算法）；左侧蓝色框是船端模型。中间绿色虚线区域标注为“迭代循环”，表示在岸端完成的试验—反馈—优化—再试验闭环；当闭环达到指标阈值后，再通过专网，将新的神经网络模型，或者是其他算法的参数下发到船端。

船端在真实海况中产生的输入数据与响应数据（传感器观测、控制指令、状态量）先进入数据库。数据库向两条支路供给数据——其一是送入算力中心用于训练与调参与评估；其二是将环境数据（如浪高/周期、风向风速、流速剖面、能见度等）回灌到仿真环境，用于把仿真场景调得更贴近实景。

在岸端模型中，算力中心与仿真环境形成闭环回路：新训练出的神经网络或控制器先在仿真中试验，得到性能与安全性的量化反馈（航迹误差、能耗、极值舵角/推力利用率等），据此继续优化参数或数据集。在部署到船端模型以后，船端运行新的策略并产生新一轮真实数据，回流数据库，闭环继续自我强化。

![岸端配合船端实现模式识别并下发更新参数](https://cdn.nlark.com/yuque/0/2025/png/2408029/1756103448465-727a8dae-a2f4-4eb5-9b2e-98476a714081.png)

这张图展示了一个“岸端—船端”协同的模式识别与参数下发框架。岸端模型由“算力中心”和“数据库”组成。船端在一些复杂的情况下，需要请求岸端进行场景/模式判定，在这一过程中，船端首先把环境数据（风浪流、能见度、交通密度等）与状态数据（位姿、速度、传感器健康、执行器负载等）上传至数据库，同时发起“请分析并配参”的请求；岸端利用算力中心强大的算力，调取历史数据、实时数据和专家经验，利用神经网络完成对模式的识别与决策，再将一整套算法参数组合回传到船端执行。（例如“夜间+视野受阻+强侧风”“港内靠泊+弱流”“GNSS劣化”等），并查表或在线优化出对应的参数组合（感知、融合、规划、控制以及可能的神经网络权重/阈值）。这些参数经校验后下发回船端，替换或叠加当前配置。通过这种划分，船端保持“轻量稳态执行”，岸端负责“重计算与全局洞见”。一方面可在多船/多场景间共享经验与数据沉淀，另一方面也使参数更新具有可追溯、可回滚和可审核的工程治理能力。

# 
# 核心技术
①无人船智能航行及机舱虚实融合测试技术

利用数字孪生技术将模型船/实船姿态信息与状态信息离线或实时映射至虚拟船舶，同时构建基于真实航道环境信息与航行场景信息的虚拟仿真空间，实现虚实融合的船舶智能航行及机舱的验证评估。本项目采用半实物仿真/HIL技术实现虚实融合测试。

②适应虚实融合环境的无人船船舶运动模型

适应虚实融合环境的无人船舶运动模型不仅需要建模船体动力学，还需接收来自测试场的风浪数据以及真实船舶的运动状态数据，同时要对系统的通信延迟、传感器特性、计算延迟等进行建模，确保在有限的计算资源下平衡模型精度和实时性。

③适应虚实融合环境的无人船动力电力运行模型

无人船动力电力系统具有品种多样、多重冗余、可注入故障、可柔性降级运行等特点，还要满足智能机舱的自动控制、健康管理功能的仿真测试要求，需要将电磁、机械、热工的模型集成到统一的时间、空间维度中运行，使模型足够全面、精细。

④无人船虚实融合测试场景展示技术

通过利用天文算法、结合真实气象数据、通过实时渲染技术，确保在虚实融合的展示场景中，实时展现真实的光照信息，为图像识别算法提供逼真的环境信息。



# 关键技术难点及应对策略
①无人船智能航行及机舱虚实融合测试场景构建

技术难点1：物理设备在正常负载、边界条件、突发故障等组合工况极多，且物理设备与环境耦合性强，传统建模难以穷举。

应对策略：构建“基础库”（功能/性能测试场景）+“补充库”（边界/故障测试场景），通过场景（实际/虚拟）识别模块自动匹配目标工况。

技术难点2：物理实体与虚拟模型的状态映射需毫秒级响应，但网络延迟与数据吞吐量限制了同步精度。

应对策略：部署5G+MQTT低延迟协议实现端到端通信；采用时间戳同步技术（如PTP/NTP协议）确保数据时序一致性。

②适应虚实融合环境的无人船运动模型构建

技术难点1：虚实融合环境下建模时需要同时考虑船体动力学、通信延迟、传感器特性、计算延迟等多重因素，在毫秒级响应要求下，传统高精度CFD建模计算量过大、无法满足实时性需求。

应对策略：基于MMG（操纵性数学模型方程组）建立快速响应的基础动力学模型，再通过神经网络学习历史数据，构建延迟补偿模型和传感器误差修正模型。

技术难点2：虚实环境下多源数据融合建模复杂性高，需同时处理来自测试场的风浪环境数据、真实船舶运动状态数据以及虚拟船舶自身的动力学参数，传统单一建模方法难以有效融合。

应对策略：采用分层建模架构，构建“环境层”（风浪流建模）+“交互层”（船-环境耦合建模）+“本体层”（船体六自由度动力学建模），通过卡尔曼滤波算法实现多源数据融合。

③适应虚实融合环境的无人船动力电力运行模型构建

技术难点：电力设备的电磁-热-力多场耦合效应难以精确模拟，且设计参数与物理实体存在动态偏差。

应对策略：结合机理模型（如有限元分析、计算流体动力学）与数据驱动模型（如深度学习），构建跨尺度模型。

④无人船虚实融合测试场景展示环境构建

技术难点：虚实融合渲染需要在保证视觉真实感的同时维持高帧率，但复杂光照模型（包括直射光、散射光、反射光）的实时计算对GPU资源消耗巨大，易造成渲染延迟和画面卡顿，影响测试场景的连续性。

应对策略：采用LOD（细节层次）渲染技术，根据距离场景视角焦点远近动态调整光照计算精度；利用预计算辐射传输技术缓存常用光照条件，结合实时光照插值算法减少计算负荷。





# 
## 输入文档
《<font style="color:rgb(0,0,0);">无人水面艇和智能船舶海上测试管理规范</font>》

《珠海万山无人艇测试场设计要素》

《船舶自主航行试验技术与检验暂行规则(2023)》

《船舶自主航行附加标志检验指南》

《无人水面艇检验指南(2024)》

## 相关标准
《**<font style="color:rgb(0,0,0);">NASA-STD-7009A</font>**》

## 



